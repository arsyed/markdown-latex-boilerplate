\documentclass[$if(draft)$$draft$,$endif$$if(fontsize)$$fontsize$,$endif$$if(lang)$$babel-lang$,$endif$$if(papersize)$$papersize$,$endif$$if(sides)$$sides$,$endif$$for(classoption)$$classoption$$sep$,$endfor$]{$documentclass$}
$if(xelatexfont)$
\usepackage{fontspec,xltxtra,xunicode}
\setmainfont{$xelatexfont$}
% \usepackage[MnSymbol]{mathspec}
% \setallmainfonts{$xelatexfont$}
$else$
$if(fontfamily)$
\usepackage{$fontfamily$}
$else$
\usepackage{mathptmx}
$endif$
$endif$

% cleveref for figure/table/eqn references
\usepackage{cleveref}

% Table of contents/appendices %
\usepackage[titletoc,title]{appendix}
\usepackage{tocloft}
\renewcommand{\cftchapleader}{\cftdotfill{\cftdotsep}}
\renewcommand{\@tocrmarg}{2.55em plus1fil}

% Section/Chapter headings
% \usepackage[raggedright]{titlesec}
% % Use the default font for headings
% \titleformat{\chapter}{\bfseries}{\chaptername~\thechapter\filright}{1.5em}{\large\bfseries\raggedright}
% \titleformat{\section}[block]{\normalfont\fontsize{12}{18}\bfseries\filcenter}{}{}{}
% \titleformat{\subsection}[block]{\normalfont\fontsize{12}{18}\bfseries\itshape}{}{}{}
% \titleformat{\subsubsection}{\normalfont\fontsize{12}{18}\itshape}{}{}{}

\usepackage{etoolbox}
\usepackage[doublespacing]{setspace}
$if(geometry)$
\usepackage{lmodern}
\usepackage{layouts}
\usepackage[$for(geometry)$$geometry$$sep$,$endfor$]{geometry}
$endif$
\usepackage[unicode=true]{hyperref}
\hypersetup{breaklinks=true,
            bookmarks=true,
            pdfauthor={$author$},
            pdftitle={$title$},
            colorlinks=false,
            % citecolor=$if(citecolor)$$citecolor$$else$blue$endif$,
            % urlcolor=$if(urlcolor)$$urlcolor$$else$blue$endif$,
            % linkcolor=$if(linkcolor)$$linkcolor$$else$magenta$endif$,
            pdfborder={0 0 0}}
% \urlstyle{same}  % don't use monospace font for urls
\PassOptionsToPackage{hyphens}{url}\usepackage{hyperref}

% to-dos
\usepackage{xargs}
\usepackage[colorinlistoftodos,prependcaption,textsize=small]{todonotes}
\newcommandx{\unsure}[2][1=]{\todo[linecolor=red,backgroundcolor=red!25,bordercolor=red,#1]{#2}}
\newcommandx{\change}[2][1=]{\todo[linecolor=blue,backgroundcolor=blue!25,bordercolor=blue,#1]{#2}}
\newcommandx{\info}[2][1=]{\todo[linecolor=OliveGreen,backgroundcolor=OliveGreen!25,bordercolor=OliveGreen,#1]{#2}}
\newcommandx{\improvement}[2][1=]{\todo[linecolor=Plum,backgroundcolor=Plum!25,bordercolor=Plum,#1]{#2}}

% use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
% use microtype if available
\IfFileExists{microtype.sty}{%
\usepackage{microtype}
\UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
$if(lang)$
  \usepackage[shorthands=off,$babel-lang$]{babel}
$endif$

\usepackage[format=hang,justification=raggedright,singlelinecheck=0,labelsep=period]{caption}
\usepackage[format=hang,justification=raggedright,singlelinecheck=0,labelsep=period]{subcaption}
$if(listings)$
\usepackage{listings}
$endif$

% syntax highlighting %
$if(highlighting-macros)$
$highlighting-macros$
$endif$

\usepackage{longtable,booktabs,multirow}

$if(graphics)$
\usepackage{graphicx,grffile}
\makeatletter
\let\@currsize\normalsize
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
$endif$

$if(strikeout)$
\usepackage[normalem]{ulem}
% avoid problems with \sout in headers with hyperref:
\pdfstringdefDisableCommands{\renewcommand{\sout}{}}
$endif$

% Line spacing %
\doublespacing
\setlength{\parindent}{4em}
\setlength{\parskip}{1em plus 2pt minus 1pt}
\setlength{\emergencystretch}{3em}  % prevent overfull lines
% \renewcommand{\baselinestretch}{2}
\providecommand{\tightlist}{%
\setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}

% Block Quotes %
\renewenvironment{quote}
               {\list{}{\listparindent=0pt%whatever you need
                        \itemindent \listparindent
                        \onehalfspacing
                        \leftmargin=0.5in%  whatever you need
                        \rightmargin=0.5in%whatever you need
                      \topsep=0pt}% whatever you need
%                         \parsep        \z@ \@plus\p@}%
                \item\relax}
               {\endlist}

% footnote formatting %
\usepackage[hang,flushmargin]{footmisc}
\let\oldfootnotesize\footnotesize
\renewcommand{\footnotesize}{\normalsize}
% \renewcommand\footnotelayout{\fontsize{10}{12}\selectfont}
% space between footnotes %
\setlength{\footnotesep}{1em}
% space between text and footnotes
\setlength{\skip\footins}{2em}

$if(verbatim-in-note)$
\usepackage{fancyvrb}
\VerbatimFootnotes
$endif$

$if(links-as-notes)$
% Make links footnotes instead of hotlinks:
\renewcommand{\href}[2]{#2\footnote{\url{#1}}}
$endif$

% Always indent the first paragraph
% \usepackage{indentfirst}

% Section numbering
$if(numbersections)$
\setcounter{secnumdepth}{5}
$else$
\setcounter{secnumdepth}{0}
$endif$

\pagestyle{headings}
$if(title)$
\title{$title$$if(subtitle)$\\\vspace{0.5em}{\large $subtitle$}$endif$}
$endif$
$if(author)$
\author{$for(author)$$author$$sep$ \and $endfor$}
$endif$
\date{$date$}
$for(header-includes)$
$header-includes$
$endfor$

% Redefines (sub)paragraphs to behave more like sections
\ifx\paragraph\undefined\else
\let\oldparagraph\paragraph
\renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
\let\oldsubparagraph\subparagraph
\renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi

\begin{document}

% Frontmatter
\frontmatter
$if(titlepage)$
$if(title)$
\begin{titlepage}
\begin{center}
\vspace{2in}
\textsc{$title$} \\[0.5in]
by \\[0.5in]
\textsc{$author$}\par
\vspace{\fill}
$if(program)$
\begin{raggedright}
A dissertation submitted to the Graduate Faculty in $program$ in partial fulfillment of the requirements for the degree of Doctor of Philosophy, The City University of New York
$title-desc$\\[0.25in]
\end{raggedright}\par
$endif$

\number\year

\end{center}
\end{titlepage}
\setcounter{page}{2}
% \maketitle
$endif$
$endif$

$if(copyrightpage)$
\phantom{}\vspace{\fill}
\begin{center}
\copyright\number\year\\
\textsc{$author$}\\
All Rights Reserved\\
\end{center}
% \makecopyrightpage
$endif$

$if(approvalpage)$
$if(program)$
\newpage
\begin{center}
This manuscript has been read and accepted by the Graduate Faculty in $program$ in satisfaction of the dissertation requirement for the degree of Doctor of Philosophy.
\end{center}

\vspace{0.75in}

\setlength{\tabcolsep}{0pt}
\begin{tabular}{p{1.75in}p{0.5in}p{3.5in}}
\multicolumn{3}{l}{\textbf{Professor $advisor$}}\\
\\
\hrulefill& &\hrulefill \\
Date & & Chair of Examining Committee\\
\\
\multicolumn{3}{l}{\textbf{Professor $eo$}}\\
\\
\hrulefill& &\hrulefill \\
Date & & Executive Officer\\
\end{tabular}

\vspace{0.75in}

\begin{tabular}{l}
  $if(comm2)$
  \textbf{Professor $comm2$} \\
  $endif$
  $if(comm3)$
  \textbf{Professor $comm3$} \\
  $endif$
  $if(comm4)$
  \textbf{Professor $comm4$} \\
  $endif$
  $if(comm5)$
  \textbf{Professor $comm5$} \\
  $endif$
Supervisory Committee \\
\end{tabular}

\vspace{\fill}
\begin{center}
\textsc{The City University of New York}
\end{center}
$endif$
$endif$

$if(abstractpage)$
$if(advisor)$
$if(abstract)$
\newpage
\begin{center}%
  Abstract \\
  \textsc{$title$} \\
  by \\
  \textsc{$author$} \\[0.25in]
\end{center}
\vspace{0.25in}
\noindent Advisor: $advisor$
\vspace{0.25in}

\noindent $abstract$

% \makeabstractpage{advisor}{abstract}
$endif$
$endif$
$endif$

% table of contents, figures, tables
$if(toc)$
{\hypersetup{linkcolor=$if(toccolor)$$toccolor$$else$black$endif$}
\setcounter{tocdepth}{$toc-depth$}
\tableofcontents}
$endif$
$if(lot)$
\listoftables
$endif$
$if(lof)$
\listoffigures
$endif$

%% \chapter*{Introduction}
%% \addcontentsline{toc}{chapter}{\numberline{}Introduction}
%% \markboth{Introduction}{INTRODUCTION}

\mainmatter

$body$

%% \backmatter
$for(include-after)$
$include-after$
$endfor$
\end{document}
